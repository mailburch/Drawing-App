<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drawing App</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #root {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Lucide Icons as inline SVGs
        const Save = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
        );

        const FolderOpen = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        const Grid3x3 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="9" y1="3" x2="9" y2="21"></line>
                <line x1="15" y1="3" x2="15" y2="21"></line>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <line x1="3" y1="15" x2="21" y2="15"></line>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Menu = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        );

        const X = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Edit3 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 20h9"></path>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg>
        );

        const Square = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            </svg>
        );

        function DrawingApp() {
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [color, setColor] = useState('#000000');
            const [brushSize, setBrushSize] = useState(3);
            const [showGrid, setShowGrid] = useState(false);
            const [canvasSize, setCanvasSize] = useState({ width: 800, height: 600 });
            const [savedDrawings, setSavedDrawings] = useState([]);
            const [folders, setFolders] = useState(['Sketches', 'Notes', 'Ideas']);
            const [currentFolder, setCurrentFolder] = useState('Sketches');
            const [showSidebar, setShowSidebar] = useState(false);
            const [drawingName, setDrawingName] = useState('');
            const [tool, setTool] = useState('pen');
            const [isMobile, setIsMobile] = useState(false);
            const [showToolbar, setShowToolbar] = useState(true);
            const [showColorPicker, setShowColorPicker] = useState(false);

            useEffect(() => {
                const checkMobile = () => {
                    setIsMobile(window.innerWidth < 768);
                    if (window.innerWidth < 768) {
                        const width = Math.min(window.innerWidth - 32, 600);
                        const height = Math.min(window.innerHeight - 200, 400);
                        setCanvasSize({ width, height });
                    }
                };
                
                checkMobile();
                window.addEventListener('resize', checkMobile);
                return () => window.removeEventListener('resize', checkMobile);
            }, []);

            useEffect(() => {
                const stored = localStorage.getItem('drawings');
                if (stored) {
                    setSavedDrawings(JSON.parse(stored));
                }
                const storedFolders = localStorage.getItem('folders');
                if (storedFolders) {
                    setFolders(JSON.parse(storedFolders));
                }
            }, []);

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                if (showGrid) {
                    drawGrid(ctx);
                }
            }, [canvasSize, showGrid]);

            const drawGrid = (ctx) => {
                const gridSize = 20;
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 0.5;
                
                for (let x = 0; x <= canvasSize.width; x += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvasSize.height);
                    ctx.stroke();
                }
                
                for (let y = 0; y <= canvasSize.height; y += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvasSize.width, y);
                    ctx.stroke();
                }
            };

            const getCoordinates = (e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            };

            const startDrawing = (e) => {
                e.preventDefault();
                const { x, y } = getCoordinates(e);
                
                setIsDrawing(true);
                const ctx = canvasRef.current.getContext('2d');
                ctx.beginPath();
                ctx.moveTo(x, y);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                e.preventDefault();
                
                const { x, y } = getCoordinates(e);
                
                const ctx = canvasRef.current.getContext('2d');
                ctx.lineTo(x, y);
                ctx.strokeStyle = tool === 'eraser' ? 'white' : color;
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.stroke();
            };

            const stopDrawing = () => {
                setIsDrawing(false);
            };

            const clearCanvas = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                if (showGrid) drawGrid(ctx);
            };

            const saveDrawing = () => {
                const canvas = canvasRef.current;
                const dataURL = canvas.toDataURL();
                const name = drawingName || `Drawing ${savedDrawings.length + 1}`;
                
                const newDrawing = {
                    id: Date.now(),
                    name,
                    folder: currentFolder,
                    data: dataURL,
                    date: new Date().toISOString(),
                    size: canvasSize
                };
                
                const updated = [...savedDrawings, newDrawing];
                setSavedDrawings(updated);
                localStorage.setItem('drawings', JSON.stringify(updated));
                setDrawingName('');
                alert('Drawing saved!');
            };

            const loadDrawing = (drawing) => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    setCanvasSize(drawing.size);
                    setTimeout(() => {
                        ctx.fillStyle = 'white';
                        ctx.fillRect(0, 0, drawing.size.width, drawing.size.height);
                        ctx.drawImage(img, 0, 0);
                    }, 50);
                };
                
                img.src = drawing.data;
                setShowSidebar(false);
            };

            const deleteDrawing = (id) => {
                const updated = savedDrawings.filter(d => d.id !== id);
                setSavedDrawings(updated);
                localStorage.setItem('drawings', JSON.stringify(updated));
            };

            const downloadDrawing = (drawing) => {
                const link = document.createElement('a');
                link.download = `${drawing.name}.png`;
                link.href = drawing.data;
                link.click();
            };

            const addFolder = () => {
                const name = prompt('Enter folder name:');
                if (name && !folders.includes(name)) {
                    const updated = [...folders, name];
                    setFolders(updated);
                    localStorage.setItem('folders', JSON.stringify(updated));
                }
            };

            const filteredDrawings = savedDrawings.filter(d => d.folder === currentFolder);

            const MobileToolbar = () => (
                <div className="bg-white border-b border-gray-200 shadow-sm">
                    <div className="flex items-center justify-between p-3">
                        <button 
                            onClick={() => setShowToolbar(!showToolbar)}
                            className="p-2 bg-gray-100 rounded"
                        >
                            {showToolbar ? <X size={20} /> : <Menu size={20} />}
                        </button>
                        
                        <div className="flex items-center gap-2">
                            <button 
                                onClick={() => setShowSidebar(true)}
                                className="p-2 bg-blue-500 text-white rounded"
                            >
                                <FolderOpen size={20} />
                            </button>
                            <button 
                                onClick={saveDrawing}
                                className="px-3 py-2 bg-green-500 text-white rounded flex items-center gap-1"
                            >
                                <Save size={16} /> Save
                            </button>
                        </div>
                    </div>

                    {showToolbar && (
                        <div className="p-3 space-y-3 border-t">
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setTool('pen')}
                                    className={`flex-1 py-2 rounded flex items-center justify-center gap-2 ${tool === 'pen' ? 'bg-blue-500 text-white' : 'bg-gray-100'}`}
                                >
                                    <Edit3 size={16} /> Pen
                                </button>
                                <button
                                    onClick={() => setTool('eraser')}
                                    className={`flex-1 py-2 rounded flex items-center justify-center gap-2 ${tool === 'eraser' ? 'bg-blue-500 text-white' : 'bg-gray-100'}`}
                                >
                                    <Square size={16} /> Eraser
                                </button>
                            </div>

                            <div className="flex items-center gap-2">
                                <button
                                    onClick={() => setShowColorPicker(!showColorPicker)}
                                    className="flex items-center gap-2 px-3 py-2 bg-gray-100 rounded flex-1"
                                >
                                    <div 
                                        className="w-6 h-6 rounded border-2 border-gray-300"
                                        style={{ backgroundColor: color }}
                                    />
                                    <span className="text-sm">Color</span>
                                </button>
                                {showColorPicker && (
                                    <input 
                                        type="color" 
                                        value={color} 
                                        onChange={(e) => setColor(e.target.value)}
                                        className="w-12 h-12 rounded cursor-pointer"
                                    />
                                )}
                            </div>

                            <div className="space-y-1">
                                <div className="flex justify-between text-sm">
                                    <span>Brush Size</span>
                                    <span className="font-medium">{brushSize}px</span>
                                </div>
                                <input 
                                    type="range" 
                                    min="1" 
                                    max="20" 
                                    value={brushSize}
                                    onChange={(e) => setBrushSize(Number(e.target.value))}
                                    className="w-full"
                                />
                            </div>

                            <div className="flex gap-2">
                                <button
                                    onClick={() => setShowGrid(!showGrid)}
                                    className={`flex-1 py-2 rounded flex items-center justify-center gap-2 ${showGrid ? 'bg-blue-500 text-white' : 'bg-gray-100'}`}
                                >
                                    <Grid3x3 size={16} /> Grid
                                </button>
                                <button 
                                    onClick={clearCanvas}
                                    className="flex-1 py-2 bg-red-500 text-white rounded"
                                >
                                    Clear
                                </button>
                            </div>

                            <select 
                                value={`${canvasSize.width}x${canvasSize.height}`}
                                onChange={(e) => {
                                    const [w, h] = e.target.value.split('x').map(Number);
                                    setCanvasSize({ width: w, height: h });
                                }}
                                className="w-full px-3 py-2 border rounded text-sm"
                            >
                                <option value="400x300">Small (400×300)</option>
                                <option value="600x400">Medium (600×400)</option>
                                <option value="800x600">Large (800×600)</option>
                            </select>

                            <input 
                                type="text"
                                placeholder="Drawing name..."
                                value={drawingName}
                                onChange={(e) => setDrawingName(e.target.value)}
                                className="w-full px-3 py-2 border rounded text-sm"
                            />
                        </div>
                    )}
                </div>
            );

            const DesktopToolbar = () => (
                <div className="bg-white border-b border-gray-200 p-4 shadow-sm">
                    <div className="flex items-center gap-4 flex-wrap">
                        <button 
                            onClick={() => setShowSidebar(!showSidebar)}
                            className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-2"
                        >
                            <FolderOpen size={16} /> Saved
                        </button>

                        <div className="flex items-center gap-2">
                            <label className="text-sm font-medium">Tool:</label>
                            <button
                                onClick={() => setTool('pen')}
                                className={`px-3 py-2 rounded ${tool === 'pen' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                            >
                                Pen
                            </button>
                            <button
                                onClick={() => setTool('eraser')}
                                className={`px-3 py-2 rounded ${tool === 'eraser' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                            >
                                Eraser
                            </button>
                        </div>

                        <div className="flex items-center gap-2">
                            <label className="text-sm font-medium">Color:</label>
                            <input 
                                type="color" 
                                value={color} 
                                onChange={(e) => setColor(e.target.value)}
                                className="w-10 h-10 rounded cursor-pointer"
                            />
                        </div>

                        <div className="flex items-center gap-2">
                            <label className="text-sm font-medium">Size:</label>
                            <input 
                                type="range" 
                                min="1" 
                                max="20" 
                                value={brushSize}
                                onChange={(e) => setBrushSize(Number(e.target.value))}
                                className="w-24"
                            />
                            <span className="text-sm w-8">{brushSize}</span>
                        </div>

                        <button
                            onClick={() => setShowGrid(!showGrid)}
                            className={`px-3 py-2 rounded flex items-center gap-2 ${showGrid ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                        >
                            <Grid3x3 size={16} /> Grid
                        </button>

                        <select 
                            value={`${canvasSize.width}x${canvasSize.height}`}
                            onChange={(e) => {
                                const [w, h] = e.target.value.split('x').map(Number);
                                setCanvasSize({ width: w, height: h });
                            }}
                            className="px-3 py-2 border rounded"
                        >
                            <option value="600x400">Small (600×400)</option>
                            <option value="800x600">Medium (800×600)</option>
                            <option value="1200x800">Large (1200×800)</option>
                            <option value="1600x1200">Extra Large (1600×1200)</option>
                        </select>

                        <button 
                            onClick={clearCanvas}
                            className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                        >
                            Clear
                        </button>
                    </div>

                    <div className="flex items-center gap-2 mt-3">
                        <input 
                            type="text"
                            placeholder="Drawing name..."
                            value={drawingName}
                            onChange={(e) => setDrawingName(e.target.value)}
                            className="px-3 py-2 border rounded flex-1 max-w-xs"
                        />
                        <button 
                            onClick={saveDrawing}
                            className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2"
                        >
                            <Save size={16} /> Save Drawing
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="flex h-screen bg-gray-100 overflow-hidden">
                    {showSidebar && (
                        <div className={`${isMobile ? 'fixed inset-0 z-50' : 'w-80'} bg-white ${isMobile ? '' : 'border-r'} border-gray-200 flex flex-col`}>
                            <div className="p-4 border-b flex justify-between items-center">
                                <h2 className="text-xl font-bold">Saved Drawings</h2>
                                <button 
                                    onClick={() => setShowSidebar(false)} 
                                    className="p-2 hover:bg-gray-100 rounded"
                                >
                                    <X size={20} />
                                </button>
                            </div>
                            
                            <div className="p-4 border-b">
                                <div className="flex items-center justify-between mb-2">
                                    <label className="text-sm font-medium">Folders</label>
                                    <button onClick={addFolder} className="text-blue-500 text-sm">+ New</button>
                                </div>
                                <select 
                                    value={currentFolder}
                                    onChange={(e) => setCurrentFolder(e.target.value)}
                                    className="w-full p-2 border rounded"
                                >
                                    {folders.map(f => (
                                        <option key={f} value={f}>{f}</option>
                                    ))}
                                </select>
                            </div>

                            <div className="flex-1 overflow-y-auto p-4">
                                <div className="space-y-3">
                                    {filteredDrawings.length === 0 ? (
                                        <p className="text-gray-400 text-sm text-center py-8">No drawings in this folder</p>
                                    ) : (
                                        filteredDrawings.map(drawing => (
                                            <div key={drawing.id} className="border rounded p-3 bg-gray-50">
                                                <img src={drawing.data} alt={drawing.name} className="w-full h-32 object-cover rounded mb-2" />
                                                <div className="text-sm font-medium mb-1 truncate">{drawing.name}</div>
                                                <div className="text-xs text-gray-500 mb-2">
                                                    {new Date(drawing.date).toLocaleDateString()}
                                                </div>
                                                <div className="flex gap-2">
                                                    <button 
                                                        onClick={() => loadDrawing(drawing)}
                                                        className="flex-1 bg-blue-500 text-white px-2 py-1 rounded text-xs"
                                                    >
                                                        Load
                                                    </button>
                                                    <button 
                                                        onClick={() => downloadDrawing(drawing)}
                                                        className="bg-green-500 text-white px-2 py-1 rounded text-xs"
                                                    >
                                                        <Download size={12} />
                                                    </button>
                                                    <button 
                                                        onClick={() => deleteDrawing(drawing.id)}
                                                        className="bg-red-500 text-white px-2 py-1 rounded text-xs"
                                                    >
                                                        <Trash2 size={12} />
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="flex-1 flex flex-col overflow-hidden">
                        {isMobile ? <MobileToolbar /> : <DesktopToolbar />}

                        <div className={`flex-1 overflow-auto ${isMobile ? 'p-2' : 'p-8'} flex items-center justify-center`}>
                            <canvas
                                ref={canvasRef}
                                width={canvasSize.width}
                                height={canvasSize.height}
                                onMouseDown={startDrawing}
                                onMouseMove={draw}
                                onMouseUp={stopDrawing}
                                onMouseLeave={stopDrawing}
                                onTouchStart={startDrawing}
                                onTouchMove={draw}
                                onTouchEnd={stopDrawing}
                                className="border-2 border-gray-300 bg-white shadow-lg cursor-crosshair"
                                style={{ touchAction: 'none', maxWidth: '100%', height: 'auto' }}
                            />
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<DrawingApp />, document.getElementById('root'));
    </script>
</body>
</html>
